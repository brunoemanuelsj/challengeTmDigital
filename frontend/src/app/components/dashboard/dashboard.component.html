<div class="dashboard-container">
  <div class="dashboard-header">
    <h1 class="dashboard-title">
      <i class="pi pi-chart-line"></i>
      Dashboard
    </h1>
    <p class="dashboard-subtitle">Visão geral dos leads e propriedades rurais</p>
  </div>

  <div *ngIf="loading()" class="loading-container">
    <i class="pi pi-spin pi-spinner" style="font-size: 2rem"></i>
    <p>Carregando estatísticas...</p>
  </div>

  <div *ngIf="!loading() && stats()" class="dashboard-content">
    <!-- Cards de Métricas Principais -->
    <div class="metrics-grid">
      <p-card styleClass="metric-card">
        <div class="metric-content">
          <div
            class="metric-icon"
            style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%)"
          >
            <i class="pi pi-users"></i>
          </div>
          <div class="metric-info">
            <span class="metric-label">Total de Leads</span>
            <span class="metric-value">{{ stats()?.totalLeads }}</span>
          </div>
        </div>
      </p-card>

      <p-card styleClass="metric-card">
        <div class="metric-content">
          <div
            class="metric-icon"
            style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%)"
          >
            <i class="pi pi-map"></i>
          </div>
          <div class="metric-info">
            <span class="metric-label">Propriedades</span>
            <span class="metric-value">{{ stats()?.propertyStats?.totalPropriedades ?? 0 }}</span>
          </div>
        </div>
      </p-card>

      <p-card styleClass="metric-card">
        <div class="metric-content">
          <div
            class="metric-icon"
            style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)"
          >
            <i class="pi pi-chart-bar"></i>
          </div>
          <div class="metric-info">
            <span class="metric-label">Área Total</span>
            <span class="metric-value"
              >{{ formatArea(stats()?.propertyStats?.areaTotal ?? 0) }} ha</span
            >
          </div>
        </div>
      </p-card>

      <p-card styleClass="metric-card">
        <div class="metric-content">
          <div
            class="metric-icon"
            style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)"
          >
            <i class="pi pi-calculator"></i>
          </div>
          <div class="metric-info">
            <span class="metric-label">Área Média</span>
            <span class="metric-value"
              >{{ formatArea(stats()?.propertyStats?.areaMedia ?? 0) }} ha</span
            >
          </div>
        </div>
      </p-card>
    </div>

    <!-- Gráficos -->
    <div class="charts-grid">
      <p-card header="Leads por Status" styleClass="chart-card">
        <div class="chart-container">
          <p-chart
            type="doughnut"
            [data]="statusChartData"
            [options]="statusChartOptions"
          ></p-chart>
        </div>
      </p-card>

      <p-card header="Top 10 Municípios" styleClass="chart-card">
        <div class="chart-container">
          <p-chart
            type="bar"
            [data]="municipioChartData"
            [options]="municipioChartOptions"
          ></p-chart>
        </div>
      </p-card>
    </div>

    <!-- Leads Prioritários -->
    <div
      class="priority-section"
      *ngIf="stats()?.priorityLeads && stats()!.priorityLeads.length > 0"
    >
      <p-card header="Leads Prioritários (Área > 100 hectares)" styleClass="priority-card">
        <p-table
          [value]="stats()!.priorityLeads"
          [tableStyle]="{ 'min-width': '50rem' }"
          styleClass="priority-table"
        >
          <ng-template pTemplate="header">
            <tr>
              <th>Nome</th>
              <th>CPF</th>
              <th>Status</th>
              <th class="text-right">Área Total (ha)</th>
              <th class="text-center">Prioridade</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-lead>
            <tr>
              <td>
                <strong>{{ lead.nome }}</strong>
              </td>
              <td>{{ lead.cpf }}</td>
              <td>
                <p-tag
                  [value]="getStatusLabel(lead.status)"
                  [severity]="getStatusSeverity(lead.status)"
                ></p-tag>
              </td>
              <td class="text-right">
                <strong>{{ formatArea(lead.totalArea) }}</strong>
              </td>
              <td class="text-center">
                <span class="priority-badge" [class.high-priority]="lead.totalArea > 500">
                  <i class="pi pi-star-fill"></i>
                  {{ lead.totalArea > 500 ? 'Alta' : 'Média' }}
                </span>
              </td>
            </tr>
          </ng-template>
          <ng-template pTemplate="emptymessage">
            <tr>
              <td colspan="5" class="text-center">Nenhum lead prioritário encontrado</td>
            </tr>
          </ng-template>
        </p-table>
      </p-card>
    </div>

    <div
      class="no-priority-leads"
      *ngIf="stats()?.priorityLeads && stats()!.priorityLeads.length === 0"
    >
      <p-card styleClass="info-card">
        <div class="info-content">
          <i class="pi pi-info-circle"></i>
          <p>Não há leads com área total superior a 100 hectares no momento.</p>
        </div>
      </p-card>
    </div>
  </div>
</div>
